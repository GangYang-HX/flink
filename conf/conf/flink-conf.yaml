#==============================================================================
#  Common
#==============================================================================

jobmanager.rpc.port: 6123
#jobmanager.heap.size: 3072m
taskmanager.heap.size: 30720m
taskmanager.numberOfTaskSlots: 10
taskmanager.memory.preallocate: false
taskmanager.memory.managed.fraction: 0.3f
parallelism.default: 10

#==============================================================================
# pipeline
#==============================================================================
#pipeline.use-stream-graph-hasher-v3: true


#==============================================================================
# Web Frontend
#==============================================================================
jobmanager.web.port: 8081

#==============================================================================
# Streaming state checkpointing
#==============================================================================
#state.backend: filesystem
#state.checkpoint.dir: hdfs://jssz-bigdata-ns1/flink/checkpoints
#state.savepoints.dir: hdfs://jssz-bigdata-ns1/flink/savepoints

#==============================================================================
# Advanced
#==============================================================================


#==============================================================================
# Master High Availability (required configuration)
#==============================================================================

#high-availability: zookeeper
#high-availability.zookeeper.quorum: 10.69.8.34:2181,10.69.1.30:2181,10.69.1.31:2181
#high-availability.storageDir: viewfs://jssz-bigdata-cluster/department/bigdata/flink/ha
#high-availability.zookeeper.path.root: /flink
yarn.application-attempts: 1

metrics.reporters: prom, slf4j
metrics.reporter.prom.class: org.apache.flink.metrics.prometheus.PrometheusReporter
metrics.reporter.prom.port: 9250-9280

taskmanager.network.netty.server.numThreads: 200
taskmanager.network.netty.client.numThreads: 200
taskmanager.network.memory.max: 4gb
# 去掉。kubernetes模式下会报错，需要单个端口
# taskmanager.rpc.port: 50201-50301

# as cgroup is set to 10, limit the java gc thread to 10
# env.java.opts: -XX:+UseG1GC -XX:ParallelGCThreads=10 -XX:MaxGCPauseMillis=100
env.java.opts: -XX:+UseG1GC

metrics.system-resource: false
metrics.system-resource-probing-interval: 10000
metrics.histogram.add: 95th
metrics.internal.query-service.port: 50100-50200
## New modify sink
metrics.reporter.slf4j.factory.class: com.bilibili.flink.metrics.slf4j.Slf4jJsonReporterFactory
metrics.reporter.slf4j.interval: 60 SECONDS
metrics.reporter.slf4j.metricFilter: taskmanager_Status_JVM_CPU_Load1,taskmanager_Status_JVM_Memory_NonHeap_Used,taskmanager_Status_JVM_Memory_NonHeap_Max,taskmanager_Status_JVM_Memory_Heap_Max,taskmanager_Status_JVM_Memory_Heap_Used,taskmanager_job_task_operator_KafkaConsumer_topic_partition_committedOffsets,taskmanager_job_task_operator_KafkaConsumer_records_consumed_rate,taskmanager_job_task_operator_KafkaConsumer_bytes_consumed_rate,taskmanager_job_task_operator_SinkMetrics_WriteSuccessRecord,taskmanager_job_task_operator_SinkMetrics_WriteSuccessSize,taskmanager_job_task_operator_KafkaConsumer_records_lag_max,taskmanager_job_task_numBytesInLocalPerSecond,taskmanager_job_task_numBytesInRemotePerSecond,taskmanager_job_task_operator_SinkMetrics_RtWriteRecord,taskmanager_job_task_operator_thread_(\\S+)_rt,taskmanager_job_task_operator_thread_(\\S+)_rpcCallbackFailure,taskmanager_job_task_operator_(\\S+)_readrt,taskmanager_job_task_operator_(\\S+)_writert,taskmanager_job_task_operator_KafkaConsumer_topic_partition_currentOffsets,taskmanager_Status_JVM_CPU_Load1UseagePercent,taskmanager_job_task_isBackPressured,taskmanager_Status_JVM_Memory_Direct_MemoryUsed,jobmanager_job_lastCheckpointSize,jobmanager_job_lastCheckpointDuration,taskmanager_job_task_idleTimeMsPerSecond,jobmanager_job_numberOfFailedCheckpoints,taskmanager_Status_cgroup_CgroupCpuThrottle,taskmanager_Status_cgroup_CgroupCpuNrThrottled,taskmanager_Status_cgroup_CgroupCpuNrPeriods,jobmanager_job_numTaskManagers,taskmanager_Status_Network_TotalMemorySegments,taskmanager_Status_Network_AvailableMemorySegments,taskmanager_Status_JVM_Memory_Direct_TotalCapacity,taskmanager_Status_Flink_Memory_Managed_Total,taskmanager_Status_Flink_Memory_Managed_Used
metrics.reporter.slf4j.labelFilter: job_name,host,subtask_index,topic,partition,task_name,job_owner,queue_name,instance_name,saber_job_name,operator_name,tm_id,operator_id,task_id,job_id,saber_job_id

state.backend.incremental: true
state.backend.rocksdb.timer-service.factory: ROCKSDB
state.backend.rocksdb.predefined-options: FLASH_SSD_OPTIMIZED

state.backend.rocksdb.metrics.block-cache-capacity: true
state.backend.rocksdb.metrics.block-cache-usage: true
state.backend.rocksdb.metrics.cur-size-all-mem-tables: true
state.backend.rocksdb.metrics.mem-table-flush-pending: true
state.backend.rocksdb.metrics.num-running-flushes: true
state.backend.rocksdb.metrics.total-sst-files-size: true

state.backend.rocksdb.checkpoint.transfer.thread.num: 10

akka.ask.timeout: 300 s
web.timeout: 300000

task.kafka_source_idle.interval: 30000
table.exec.source.idle-timeout: 30 s
cluster.evenly-spread-out-slots: true
hadoop.conf.jssz-realyarn-ns.path: /etc/realhdfs
hadoop.conf.jssz-bigdata-ns1.path: /etc/second-hadoop
akka.framesize: 1205725860
metrics.latency.interval: 1000

env.java.opts.jobmanager: "-Dlog4j2.formatMsgNoLookups=true"
env.java.opts.taskmanager: "-Dlog4j2.formatMsgNoLookups=true"

# print stream type
taskmanager.print.stream.type: log
